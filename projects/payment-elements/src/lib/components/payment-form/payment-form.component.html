<div class="payment-container">
  @if (amount) {
  <div class="amount-display">
    <div class="amount-value">{{ currency }} {{ amount }}</div>
  </div>
  }

  <div class="gateway-selector">
    @for (g of gateways; track g.id) {
    <button
      type="button"
      class="gateway-btn"
      [class.active]="g.id === selectedGateway()"
      (click)="selectGateway(g.id)"
    >
      {{ g.name }}
    </button>
    }
  </div>

  @if (statusMessage(); as msg) {
  <div [class]="messageType() + '-message'">
    {{ msg }}
  </div>
  }

  <form [formGroup]="paymentForm" (ngSubmit)="handleSubmit()">
    <div class="form-group">
      <label for="cardHolder">Card Holder Name</label>
      <input
        type="text"
        id="cardHolder"
        formControlName="cardHolder"
        placeholder="John Doe"
        [class.error]="
          paymentForm.get('cardHolder')?.invalid && paymentForm.get('cardHolder')?.touched
        "
      />
      @if (paymentForm.get('cardHolder')?.invalid && paymentForm.get('cardHolder')?.touched) {
      <div class="field-error">Card holder name is required</div>
      }
    </div>

    <div class="form-group">
      <label for="cardNumber">Card Number</label>
      <input
        type="text"
        id="cardNumber"
        formControlName="cardNumber"
        placeholder="1234 5678 9012 3456"
        (input)="formatCardNumber($event)"
        [class.error]="
          paymentForm.get('cardNumber')?.invalid && paymentForm.get('cardNumber')?.touched
        "
      />
      @if (paymentForm.get('cardNumber')?.invalid && paymentForm.get('cardNumber')?.touched) {
      <div class="field-error">Valid card number is required</div>
      }
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="expiry">Expiry Date</label>
        <input
          type="text"
          id="expiry"
          formControlName="expiryDate"
          placeholder="MM/YY"
          (input)="formatExpiry($event)"
          maxlength="5"
          [class.error]="
            paymentForm.get('expiryDate')?.invalid && paymentForm.get('expiryDate')?.touched
          "
        />
        @if (paymentForm.get('expiryDate')?.invalid && paymentForm.get('expiryDate')?.touched) {
        <div class="field-error">Valid expiry date is required</div>
        }
      </div>
      <div class="form-group">
        <label for="cvv">CVV</label>
        <input
          type="text"
          id="cvv"
          formControlName="cvv"
          placeholder="123"
          maxlength="4"
          (input)="formatCVV($event)"
          [class.error]="paymentForm.get('cvv')?.invalid && paymentForm.get('cvv')?.touched"
        />
        @if (paymentForm.get('cvv')?.invalid && paymentForm.get('cvv')?.touched) {
        <div class="field-error">Valid CVV is required</div>
        }
      </div>
    </div>

    <button type="submit" class="submit-btn" [disabled]="isProcessing() || paymentForm.invalid">
      {{ isProcessing() ? 'Processing...' : 'Process Payment' }}
    </button>
  </form>
</div>
